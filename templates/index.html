{% extends 'base.html' %}

{% block content %}
<h1 class="mt-2">PPT Generator</h1>
<p class="lead">Generate PPT from JSON data</p>

<div class="form-floating">
    <div class="input-group mb-4">
        <input type="text" class="form-control" placeholder="File Name" id="floatingInput" aria-label="File Name"
            aria-describedby="basic-addon2">
        <span class="input-group-text" id="basic-addon2">.pptx</span>
    </div>
</div>
<div class="form-floating mb-8">
    <textarea class="form-control" style="height: 500px" placeholder="Your ppt JSON data here."
        id="floatingTextarea"></textarea>
    <label for="floatingTextarea">JSON Data</label>
    <button type="button" class="btn btn-dark w-100 mt-3 mb-4" id="generateButton" onclick="generatePpt()">
        Generate PPT
    </button>
</div>

<script>
    function generatePpt() {
        const fileName = document.getElementById('floatingInput').value;
        const jsonData = document.getElementById('floatingTextarea').value;
        const button = document.getElementById('generateButton');

        // Validate inputs
        if (!jsonData.trim()) {
            alert('Please enter JSON data');
            return;
        }

        // Validate JSON
        try {
            JSON.parse(jsonData);
        } catch (e) {
            alert('Invalid JSON format: ' + e.message);
            return;
        }

        // Disable button and show loading state
        button.disabled = true;
        button.textContent = 'Generating...';

        fetch('/generate_ppt', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ file_name: fileName, json_data: jsonData }),
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.error || 'Failed to generate PPT');
                    });
                }
                return response.blob();
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${fileName || 'presentation'}.pptx`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);

                // Reset button
                button.disabled = false;
                button.textContent = 'Generate PPT';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating PPT: ' + error.message);

                // Reset button
                button.disabled = false;
                button.textContent = 'Generate PPT';
            });
    }
</script>
{% endblock %}